"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[597],{1597:(se,h,a)=>{a.r(h),a.d(h,{RoleModule:()=>ne});var d=a(177),e=a(7705),v=a(5261),m=a(2791),b=a(4058);const E=["noticeSwal"];function F(n,s){if(1&n&&(e.qex(0),e.j41(1,"div",22),e.nrm(2,"span",23),e.EFF(3),e.nI1(4,"titlecase"),e.k0s(),e.bVm()),2&n){const t=s.$implicit;e.R7$(3),e.SpI("",e.bMT(4,1,t.name)," ")}}const f=function(){return[]};function x(n,s){if(1&n&&(e.j41(0,"div",22),e.nrm(1,"span",23),e.j41(2,"em"),e.EFF(3),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(3),e.SpI(" ",0===(t.permissions||e.lJ4(1,f)).length?"No permissions given...":"and "+((t.permissions||e.lJ4(2,f)).length-5)+" more..."," ")}}const y=function(n){return["/apps/roles",n]},I=function(n){return["/apps/roles/edit",n]};function C(n,s){if(1&n&&(e.qex(0),e.j41(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14)(5,"h2"),e.EFF(6),e.nI1(7,"titlecase"),e.k0s()()(),e.j41(8,"div",15)(9,"div",16),e.EFF(10),e.k0s(),e.j41(11,"div",17),e.DNE(12,F,5,3,"ng-container",10),e.DNE(13,x,4,3,"div",18),e.k0s()(),e.j41(14,"div",19)(15,"a",20),e.EFF(16,"View Role"),e.k0s(),e.j41(17,"a",21),e.EFF(18,"Edit Role"),e.k0s()()()(),e.bVm()),2&n){const t=s.$implicit;e.R7$(6),e.JRh(e.bMT(7,6,t.name)),e.R7$(4),e.SpI("Total users with this role: ",(t.users||e.lJ4(8,f)).length,""),e.R7$(2),e.Y8G("ngForOf",(t.permissions||e.lJ4(9,f)).slice(0,5)),e.R7$(1),e.Y8G("ngIf",(t.permissions||e.lJ4(10,f)).length>5||0===(t.permissions||e.lJ4(11,f)).length),e.R7$(2),e.Y8G("routerLink",e.eq3(12,y,t.id)),e.R7$(2),e.Y8G("routerLink",e.eq3(14,I,t.id))}}function j(n,s){if(1&n&&(e.qex(0),e.DNE(1,C,19,16,"ng-container",10),e.bVm()),2&n){const t=s.ngIf;e.R7$(1),e.Y8G("ngForOf",t.data)}}let k=(()=>{class n{apiService;cdr;roles$;noticeSwal;swalOptions={};constructor(t,o){this.apiService=t,this.cdr=o}ngOnInit(){this.roles$=this.apiService.getRoles()}ngOnDestroy(){}static \u0275fac=function(o){return new(o||n)(e.rXU(v.W),e.rXU(e.gRc))};static \u0275cmp=e.VBU({type:n,selectors:[["app-role-listing"]],viewQuery:function(o,i){if(1&o&&e.GBs(E,5),2&o){let r;e.mGM(r=e.lsd())&&(i.noticeSwal=r.first)}},decls:12,vars:4,consts:[[1,"row","row-cols-1","row-cols-md-2","row-cols-xl-3","g-5","g-xl-9"],[4,"ngIf"],[1,"ol-md-4"],[1,"card","h-md-100"],[1,"card-body","d-flex","flex-center"],["routerLink","/apps/roles/create",1,"btn","btn-clear","d-flex","flex-column","flex-center"],["src","assets/media/illustrations/sketchy-1/4.png","alt","",1,"mw-100","mh-150px","mb-7"],[1,"fw-bold","fs-3","text-gray-600","text-hover-primary"],[3,"swalOptions"],["noticeSwal",""],[4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","card-flush","h-md-100"],[1,"card-header"],[1,"card-title"],[1,"card-body","pt-1"],[1,"fw-bold","text-gray-600","mb-5"],[1,"d-flex","flex-column","text-gray-600"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"card-footer","flex-wrap","pt-0"],[1,"btn","btn-light","btn-active-primary","my-1","me-2",3,"routerLink"],[1,"btn","btn-light","btn-active-light-primary","my-1",3,"routerLink"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"]],template:function(o,i){1&o&&(e.j41(0,"div",0),e.DNE(1,j,2,1,"ng-container",1),e.nI1(2,"async"),e.j41(3,"div",2)(4,"div",3)(5,"div",4)(6,"a",5),e.nrm(7,"img",6),e.j41(8,"div",7),e.EFF(9,"Add New Role"),e.k0s()()()()()(),e.nrm(10,"swal",8,9)),2&o&&(e.R7$(1),e.Y8G("ngIf",e.bMT(2,2,i.roles$)),e.R7$(9),e.Y8G("swalOptions",i.swalOptions))},dependencies:[d.Sq,d.bT,m.Wk,b.b7,d.Jj,d.PV]})}return n})();var S=a(7586),_=a.n(S),G=a(572);function T(n,s){if(1&n&&(e.j41(0,"div",18),e.nrm(1,"span",19),e.EFF(2),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" ",t.name," ")}}function D(n,s){if(1&n&&(e.j41(0,"div",18),e.nrm(1,"span",19),e.j41(2,"em"),e.EFF(3),e.k0s()()),2&n){const t=e.XpG(2).ngIf;e.R7$(3),e.SpI("and ",(t.permissions.length||0)-5," more...")}}function w(n,s){if(1&n&&(e.qex(0),e.DNE(1,T,3,1,"div",17),e.DNE(2,D,4,1,"div",17),e.bVm()),2&n){const t=s.index,o=e.XpG().ngIf;e.R7$(1),e.Y8G("ngIf",t<5),e.R7$(1),e.Y8G("ngIf",5===t&&(o.permissions.length||0)>5)}}const Y=function(){return[]};function N(n,s){if(1&n&&(e.qex(0),e.DNE(1,w,3,2,"ng-container",16),e.bVm()),2&n){const t=s.ngIf;e.R7$(1),e.Y8G("ngForOf",t.permissions||e.lJ4(1,Y))}}const L=function(n){return["/apps/roles/edit",n]};function O(n,s){if(1&n&&(e.qex(0),e.j41(1,"a",20),e.EFF(2,"Editar Rol"),e.k0s(),e.bVm()),2&n){const t=s.ngIf;e.R7$(1),e.Y8G("routerLink",e.eq3(1,L,t.id))}}function M(n,s){if(1&n&&(e.qex(0),e.j41(1,"span",21),e.EFF(2),e.k0s(),e.bVm()),2&n){const t=s.ngIf;e.R7$(2),e.SpI("(",t.users.length||0,")")}}let X=(()=>{class n{route;apiService;role$;datatableConfig={};reloadEvent=new e.bkB;constructor(t,o){this.route=t,this.apiService=o}ngOnInit(){this.route.params.subscribe(t=>{const o=t.id;this.role$=this.apiService.getRole(o),this.datatableConfig={serverSide:!0,ajax:(i,r)=>{this.apiService.getUsers(o,i).subscribe(l=>{console.log(l),r(l)})},columns:[{title:"Name",data:"name",render:function(i,r,l){const p=["success","info","warning","danger"],u=p[Math.floor(Math.random()*p.length)],ie=i[0].toUpperCase();return`\n              <div class="symbol symbol-circle symbol-50px overflow-hidden me-3" data-action="view" data-id="${l.id}">\n                <a href="javascript:;">\n                  \n              <div class="symbol-label fs-3 bg-light-${u} text-${u}">\n                ${ie}\n              </div>\n            \n                </a>\n              </div>\n              \n              <div class="d-flex flex-column" data-action="view" data-id="${l.id}">\n                <a href="javascript:;" class="text-gray-800 text-hover-primary mb-1">${i}</a>\n                <span>${l.email}</span>\n              </div>\n            \n            `}},{title:"Role",data:"role",render:function(i,r,l){const p=l.roles||[];return(p.length>0?p[0]?.name:"")||""},orderData:[1],orderSequence:["asc","desc"],type:"string"},{title:"Last Login",data:"last_login_at",render:(i,r,l)=>{const p=i||l.created_at;return`<div class="badge badge-light fw-bold">${_()(p).fromNow()}</div>`}},{title:"Joined Date",data:"created_at",render:function(i){return _()(i).format("DD MMM YYYY, hh:mm a")}}],createdRow:function(i,r,l){$("td:eq(0)",i).addClass("d-flex align-items-center")}}})}deleteUser(t){this.route.params.subscribe(o=>{this.apiService.deleteUser(o.id,t).subscribe(()=>{this.reloadEvent.emit(!0)})})}static \u0275fac=function(o){return new(o||n)(e.rXU(m.nX),e.rXU(v.W))};static \u0275cmp=e.VBU({type:n,selectors:[["app-role-details"]],decls:26,vars:14,consts:[[1,"d-flex","flex-column","flex-lg-row"],[1,"flex-column","flex-lg-row-auto","w-100","w-lg-200px","w-xl-300px","mb-10"],[1,"card","card-flush"],[1,"card-header"],[1,"card-title"],[1,"mb-0"],[1,"card-body","pt-0"],[1,"d-flex","flex-column","text-gray-600"],[4,"ngIf"],[1,"card-footer","pt-0"],[1,"flex-lg-row-fluid","ms-lg-10"],[1,"card","card-flush","mb-6","mb-xl-9"],[1,"card-header","pt-5"],[1,"d-flex","align-items-center"],[1,"card-toolbar"],[3,"datatableConfig","reload","deleteEvent"],[4,"ngFor","ngForOf"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[1,"btn","btn-light","btn-active-primary",3,"routerLink"],[1,"text-gray-600","fs-6","ms-1"]],template:function(o,i){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e.EFF(6),e.nI1(7,"async"),e.k0s()()(),e.j41(8,"div",6)(9,"div",7),e.DNE(10,N,2,2,"ng-container",8),e.nI1(11,"async"),e.k0s()(),e.j41(12,"div",9),e.DNE(13,O,3,3,"ng-container",8),e.nI1(14,"async"),e.k0s()()(),e.j41(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",4)(19,"h2",13),e.EFF(20,"Users Assigned "),e.DNE(21,M,3,1,"ng-container",8),e.nI1(22,"async"),e.k0s()(),e.nrm(23,"div",14),e.k0s(),e.j41(24,"div",6)(25,"app-crud",15),e.bIt("deleteEvent",function(l){return i.deleteUser(l)}),e.k0s()()()()()),2&o){let r;e.R7$(6),e.SpI(" ",null==(r=e.bMT(7,6,i.role$))?null:r.name," "),e.R7$(4),e.Y8G("ngIf",e.bMT(11,8,i.role$)),e.R7$(3),e.Y8G("ngIf",e.bMT(14,10,i.role$)),e.R7$(8),e.Y8G("ngIf",e.bMT(22,12,i.role$)),e.R7$(4),e.Y8G("datatableConfig",i.datatableConfig)("reload",i.reloadEvent)}},dependencies:[d.Sq,d.bT,m.Wk,G.i,d.Jj]})}return n})();var c=a(9417),g=a(928),U=a(8646),V=a(427),J=a(6354),P=a(7468),A=a(7030);function B(n,s){1&n&&(e.j41(0,"small"),e.EFF(1,"El nombre del rol es obligatorio"),e.k0s())}function W(n,s){1&n&&(e.j41(0,"small"),e.EFF(1,"El nombre debe tener al menos 3 caracteres"),e.k0s())}function q(n,s){if(1&n&&(e.j41(0,"div",19),e.DNE(1,B,2,0,"small",17),e.DNE(2,W,2,0,"small",17),e.k0s()),2&n){const t=e.XpG();let o,i;e.R7$(1),e.Y8G("ngIf",null==(o=t.roleForm.get("name"))?null:o.hasError("required")),e.R7$(1),e.Y8G("ngIf",null==(i=t.roleForm.get("name"))?null:i.hasError("minlength"))}}function H(n,s){1&n&&(e.j41(0,"div",20)(1,"div",21)(2,"span",22),e.EFF(3,"Cargando..."),e.k0s()()())}function z(n,s){if(1&n){const t=e.RV6();e.j41(0,"div",25)(1,"div",26)(2,"input",27),e.bIt("change",function(){const r=e.eBV(t).$implicit,l=e.XpG(2);return e.Njj(l.togglePermission(r.id))}),e.k0s(),e.j41(3,"label",28),e.EFF(4),e.k0s()()()}if(2&n){const t=s.$implicit,o=e.XpG(2);e.R7$(2),e.Y8G("id","permission_"+t.id)("checked",o.isPermissionSelected(t.id)),e.R7$(1),e.Y8G("for","permission_"+t.id),e.R7$(1),e.SpI(" ",t.name," ")}}function Q(n,s){if(1&n&&(e.j41(0,"div",23),e.DNE(1,z,5,4,"div",24),e.k0s()),2&n){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.permissions)}}function Z(n,s){1&n&&(e.j41(0,"div",29),e.EFF(1," No hay permisos disponibles en el sistema. "),e.k0s())}function K(n,s){1&n&&(e.j41(0,"span"),e.EFF(1,"Guardar"),e.k0s())}function ee(n,s){1&n&&(e.j41(0,"span",30),e.EFF(1," Guardando... "),e.nrm(2,"span",31),e.k0s())}const te=function(){return["/apps/roles"]};let R=(()=>{class n{fb;roleService;permissionService;route;router;roleForm;role;roleId;permissions=[];isLoading=!1;isSubmitting=!1;constructor(t,o,i,r,l){this.fb=t,this.roleService=o,this.permissionService=i,this.route=r,this.router=l,this.roleForm=this.fb.group({name:["",[c.k0.required,c.k0.minLength(3)]],description:[""],permissions:[[]]})}ngOnInit(){this.route.params.subscribe(t=>{this.roleId=+t.id,this.loadData()})}loadData(){this.isLoading=!0;const t=this.permissionService.getPermissions({}).pipe((0,J.T)(i=>i.data)),o=this.roleId?this.roleService.getRole(this.roleId):null;o?(0,P.p)([t,o]).subscribe({next:([i,r])=>{this.permissions=i,this.role=r,this.roleForm.patchValue({name:r.name,description:r.description||"",permissions:r.permissions.map(l=>l.id)}),this.isLoading=!1},error:i=>{console.error("Error loading data",i),this.isLoading=!1}}):t.subscribe({next:i=>{this.permissions=i,this.isLoading=!1},error:i=>{console.error("Error loading permissions",i),this.isLoading=!1}})}onSubmit(){if(this.roleForm.invalid)return;this.isSubmitting=!0;const t=this.roleForm.value;(this.roleId?this.roleService.updateRole(this.roleId,t):this.roleService.createRole(t)).subscribe({next:()=>{this.showSuccessAlert(),this.router.navigate(["/apps/roles"])},error:i=>{console.error("Error saving role",i),this.showErrorAlert(i),this.isSubmitting=!1},complete:()=>{this.isSubmitting=!1}})}isPermissionSelected(t){const o=this.roleForm.get("permissions")?.value;return!!o&&o.includes(t)}togglePermission(t){const o=this.roleForm.get("permissions")?.value||[],i=o.indexOf(t);i>-1?o.splice(i,1):o.push(t),this.roleForm.patchValue({permissions:o})}showSuccessAlert(){alert(this.roleId?"Rol actualizado correctamente":"Rol creado correctamente")}showErrorAlert(t){const o={icon:"error",title:"Error",text:this.extractErrorMessage(t)||"Ha ocurrido un error al guardar el rol",confirmButtonText:"Aceptar"};alert(o.text)}extractErrorMessage(t){if(t.error&&"object"==typeof t.error){const o=[];for(const i in t.error)Array.isArray(t.error[i])&&o.push(...t.error[i]);return o.join("\n")}return t.message||t.statusText||"Error desconocido"}static \u0275fac=function(o){return new(o||n)(e.rXU(c.ok),e.rXU(v.W),e.rXU(A.n),e.rXU(m.nX),e.rXU(m.Ix))};static \u0275cmp=e.VBU({type:n,selectors:[["app-role-edit"]],decls:27,vars:11,consts:[[1,"card"],[1,"card-header"],[1,"card-title"],[3,"formGroup","ngSubmit"],[1,"card-body"],[1,"mb-5"],[1,"form-label","required"],["type","text","formControlName","name","placeholder","Ej: Admin, Editor, Vendedor, etc.",1,"form-control"],["class","text-danger mt-2",4,"ngIf"],[1,"form-label"],["formControlName","description","rows","3","placeholder","Describe las responsabilidades de este rol...",1,"form-control"],["class","d-flex justify-content-center my-5",4,"ngIf"],["class","permission-list",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"card-footer"],["type","button",1,"btn","btn-light","me-3",3,"routerLink"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["class","indicator-progress",4,"ngIf"],[1,"text-danger","mt-2"],[1,"d-flex","justify-content-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"permission-list"],["class","permission-item",4,"ngFor","ngForOf"],[1,"permission-item"],[1,"form-check","form-check-custom","form-check-solid"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],[1,"alert","alert-warning"],[1,"indicator-progress"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,i){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.EFF(3),e.k0s()(),e.j41(4,"form",3),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Nombre del Rol"),e.k0s(),e.nrm(9,"input",7),e.DNE(10,q,3,2,"div",8),e.k0s(),e.j41(11,"div",5)(12,"label",9),e.EFF(13,"Descripci\xf3n"),e.k0s(),e.nrm(14,"textarea",10),e.k0s(),e.j41(15,"div",5)(16,"label",9),e.EFF(17,"Permisos"),e.k0s(),e.DNE(18,H,4,0,"div",11),e.DNE(19,Q,2,1,"div",12),e.DNE(20,Z,2,0,"div",13),e.k0s()(),e.j41(21,"div",14)(22,"button",15),e.EFF(23," Cancelar "),e.k0s(),e.j41(24,"button",16),e.DNE(25,K,2,0,"span",17),e.DNE(26,ee,3,0,"span",18),e.k0s()()()()),2&o){let r;e.R7$(3),e.JRh(i.roleId?"Editar Rol":"Crear Nuevo Rol"),e.R7$(1),e.Y8G("formGroup",i.roleForm),e.R7$(6),e.Y8G("ngIf",(null==(r=i.roleForm.get("name"))?null:r.invalid)&&((null==(r=i.roleForm.get("name"))?null:r.dirty)||(null==(r=i.roleForm.get("name"))?null:r.touched))),e.R7$(8),e.Y8G("ngIf",i.isLoading),e.R7$(1),e.Y8G("ngIf",!i.isLoading),e.R7$(1),e.Y8G("ngIf",!i.isLoading&&0===i.permissions.length),e.R7$(2),e.Y8G("routerLink",e.lJ4(10,te)),e.R7$(2),e.Y8G("disabled",i.roleForm.invalid||i.isSubmitting),e.R7$(1),e.Y8G("ngIf",!i.isSubmitting),e.R7$(1),e.Y8G("ngIf",i.isSubmitting)}},dependencies:[d.Sq,d.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,m.Wk],styles:['.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.required[_ngcontent-%COMP%]:after{content:" *";color:red}.permission-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.permission-item[_ngcontent-%COMP%]{padding:.5rem;border-bottom:1px solid #eee}.permission-item[_ngcontent-%COMP%]:last-child{border-bottom:none}']})}return n})(),ne=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({imports:[d.MD,c.YN,c.X1,m.iI.forChild([{path:"",component:k},{path:"create",component:R},{path:"edit/:id",component:R},{path:":id",component:X}]),V.B,U.G,g.Pv,g.zH,g.HC,g.n8,b.RZ.forChild()]})}return n})()}}]);