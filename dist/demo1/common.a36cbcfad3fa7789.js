"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[76],{7030:(v,P,o)=>{o.d(P,{n:()=>g});var d=o(1626),L=o(8810),c=o(9437),p=o(7583),h=o(7705),u=o(4367);let g=(()=>{class l{http;authService;apiUrl=`${p.qA}/admin/permissions`;constructor(e,s){this.http=e,this.authService=s}getHeaders(){const e=this.authService.token||localStorage.getItem("token");return e?new d.Lr({Authorization:"Bearer "+e,"X-User-Permission":"manage-users","Content-Type":"application/json"}):(console.warn("No hay token disponible para permisos"),new d.Lr({"Content-Type":"application/json"}))}handleError=e=>(console.error("Error en API de permisos:",e),403===e.status&&console.error("Error de permisos para gesti\xf3n de permisos"),(0,L.$)(()=>e));getPermissions(e){const s=`${this.apiUrl}-list`,a=this.getHeaders();return this.http.post(s,e,{headers:a}).pipe((0,c.W)(this.handleError))}getPermission(e){const s=`${this.apiUrl}/${e}`,a=this.getHeaders();return this.http.get(s,{headers:a}).pipe((0,c.W)(this.handleError))}createPermission(e){const s=this.getHeaders();return this.http.post(this.apiUrl,e,{headers:s}).pipe((0,c.W)(this.handleError))}updatePermission(e,s){const a=`${this.apiUrl}/${e}`,_=this.getHeaders();return this.http.put(a,s,{headers:_}).pipe((0,c.W)(this.handleError))}deletePermission(e){const s=`${this.apiUrl}/${e}`,a=this.getHeaders();return this.http.delete(s,{headers:a}).pipe((0,c.W)(this.handleError))}static \u0275fac=function(s){return new(s||l)(h.KVO(d.Qq),h.KVO(u.uR))};static \u0275prov=h.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},5261:(v,P,o)=>{o.d(P,{W:()=>g});var d=o(1626),L=o(8810),c=o(9437),p=o(7583),h=o(7705),u=o(4367);let g=(()=>{class l{http;authService;apiUrl=`${p.qA}/admin/roles`;constructor(e,s){this.http=e,this.authService=s}getHeaders(){const e=this.authService.token||localStorage.getItem("token");return e?new d.Lr({Authorization:"Bearer "+e,"X-User-Permission":"manage-users","Content-Type":"application/json"}):(console.warn("No hay token disponible para roles"),new d.Lr({"Content-Type":"application/json"}))}handleError=e=>(console.error("Error en API de roles:",e),403===e.status&&console.error("Error de permisos para gesti\xf3n de roles"),(0,L.$)(()=>e));getUsers(e,s){const a=`${this.apiUrl}/${e}/users`,_=this.getHeaders();return this.http.post(a,s,{headers:_}).pipe((0,c.W)(this.handleError))}getRoles(e){const s=`${this.apiUrl}-list`,a=this.getHeaders();return this.http.post(s,e,{headers:a}).pipe((0,c.W)(this.handleError))}getRole(e){const s=`${this.apiUrl}/${e}`,a=this.getHeaders();return this.http.get(s,{headers:a}).pipe((0,c.W)(this.handleError))}createRole(e){const s=this.getHeaders();return this.http.post(this.apiUrl,e,{headers:s}).pipe((0,c.W)(this.handleError))}updateRole(e,s){const a=`${this.apiUrl}/${e}`,_=this.getHeaders();return this.http.put(a,s,{headers:_}).pipe((0,c.W)(this.handleError))}deleteRole(e){const s=`${this.apiUrl}/${e}`,a=this.getHeaders();return this.http.delete(s,{headers:a}).pipe((0,c.W)(this.handleError))}deleteUser(e,s){const a=`${this.apiUrl}/${e}/users/${s}`,_=this.getHeaders();return this.http.delete(a,{headers:_}).pipe((0,c.W)(this.handleError))}static \u0275fac=function(s){return new(s||l)(h.KVO(d.Qq),h.KVO(u.uR))};static \u0275prov=h.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},499:(v,P,o)=>{o.d(P,{b:()=>s});var d=o(1626),L=o(4412),c=o(8810),p=o(8141),h=o(9437),u=o(980),g=o(7583),l=o(7705),f=o(4367),e=o(4956);let s=(()=>{class a{http;authservice;permissionService;isLoading$;isLoadingSubject;constructor(t,r,n){this.http=t,this.authservice=r,this.permissionService=n,this.isLoadingSubject=new L.t(!1),this.isLoading$=this.isLoadingSubject.asObservable()}isServiceReady(){const t=localStorage.getItem("token")||this.authservice.token,r=localStorage.getItem("user_permissions");return!(!t||!r)}getHeaders(t=!1){const r=this.authservice.token||localStorage.getItem("token");if(!r){console.warn("No hay token disponible");const U={};return t||(U["Content-Type"]="application/json"),new d.Lr(U)}this.isServiceReady()||console.warn("Servicio no est\xe1 completamente inicializado, usando valores por defecto");let n="";this.permissionService.hasPermission("manage-all-announcements")?(n="manage-all-announcements",console.log("Usando permiso manage-all-announcements para encabezados")):this.permissionService.hasPermission("manage-own-announcements")?(n="manage-own-announcements",console.log("Usando permiso manage-own-announcements para encabezados")):(console.warn("No se encontr\xf3 ning\xfan permiso v\xe1lido para productos, usando valor por defecto"),n="manage-own-announcements");const i={Authorization:"Bearer "+r,"X-User-Permission":n};t||(i["Content-Type"]="application/json");const E=new d.Lr(i),m=r&&r.length>10?r.substring(0,10)+"...":"token_corto";return console.log("Headers generados:",{Authorization:"Bearer "+m,"X-User-Permission":n}),E}handleError=t=>(console.error("Error en API:",t),403===t.status?(console.error("Error de permisos 403:",t),console.error("Detalles del error:",t.error||t.message)):401===t.status&&console.error("Error de autenticaci\xf3n 401:",t),(0,c.$)(()=>t));listProducts(t=1,r){this.isLoadingSubject.next(!0);let n=this.getHeaders();return this.http.post(g.qA+"/admin/products/index?page="+t,r,{headers:n}).pipe((0,p.M)(E=>{console.log("Respuesta exitosa en listProducts:",E)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}configAll(){this.isLoadingSubject.next(!0);let t=this.getHeaders();return this.http.get(g.qA+"/admin/products/config",{headers:t}).pipe((0,p.M)(n=>{console.log("Respuesta exitosa en configAll (AvisOnline):",n)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}createProducts(t){this.isLoadingSubject.next(!0);const r=this.authservice.token||localStorage.getItem("token");let n="";this.permissionService.hasPermission("manage-all-announcements")?n="manage-all-announcements":(this.permissionService.hasPermission("manage-own-announcements"),n="manage-own-announcements");const i=new d.Lr({Authorization:"Bearer "+r,"X-User-Permission":n});let E=g.qA+"/admin/products";return console.log("Intentando crear producto con permiso:",n),this.http.post(E,t,{headers:i}).pipe((0,p.M)(m=>{console.log("Respuesta exitosa al crear producto:",m)}),(0,h.W)(m=>(console.error("Error en createProducts:",m),403===m.status&&console.error("Error de permisos 403:",m.error||m.message),this.handleError(m))),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}showProduct(t){this.isLoadingSubject.next(!0);let r=this.getHeaders();return this.http.get(g.qA+"/admin/products/"+t,{headers:r}).pipe((0,p.M)(i=>{console.log("Respuesta exitosa en showProduct:",i)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}updateProducts(t,r){this.isLoadingSubject.next(!0);const n=this.authservice.token||localStorage.getItem("token");let i="";this.permissionService.hasPermission("manage-all-announcements")?i="manage-all-announcements":(this.permissionService.hasPermission("manage-own-announcements"),i="manage-own-announcements");const E=new d.Lr({Authorization:"Bearer "+n,"X-User-Permission":i});return this.http.post(g.qA+"/admin/products/"+t,r,{headers:E}).pipe((0,p.M)(U=>{console.log("Respuesta exitosa al actualizar producto:",U)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}deleteProduct(t){this.isLoadingSubject.next(!0);let r=this.getHeaders();return this.http.delete(g.qA+"/admin/products/"+t,{headers:r}).pipe((0,p.M)(i=>{console.log("Respuesta exitosa al eliminar producto:",i)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}imagenAdd(t){this.isLoadingSubject.next(!0);const r=this.authservice.token||localStorage.getItem("token");let n="";this.permissionService.hasPermission("manage-all-announcements")?n="manage-all-announcements":(this.permissionService.hasPermission("manage-own-announcements"),n="manage-own-announcements");const i=new d.Lr({Authorization:"Bearer "+r,"X-User-Permission":n});return this.http.post(g.qA+"/admin/products/imagens",t,{headers:i}).pipe((0,p.M)(m=>{console.log("Respuesta exitosa al agregar imagen:",m)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}deleteImageProduct(t){this.isLoadingSubject.next(!0);let r=this.getHeaders();return this.http.delete(g.qA+"/admin/products/imagens/"+t,{headers:r}).pipe((0,p.M)(i=>{console.log("Respuesta exitosa al eliminar imagen:",i)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}getUserStats(){this.isLoadingSubject.next(!0);let t=this.getHeaders();return this.http.get(g.qA+"/admin/products/user/stats",{headers:t}).pipe((0,p.M)(n=>{console.log("Respuesta exitosa en getUserStats:",n)}),(0,h.W)(this.handleError),(0,u.j)(()=>this.isLoadingSubject.next(!1)))}static \u0275fac=function(r){return new(r||a)(l.KVO(d.Qq),l.KVO(f.uR),l.KVO(e.n))};static \u0275prov=l.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()}}]);