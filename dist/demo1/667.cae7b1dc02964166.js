"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[667],{1667:(y,c,a)=>{a.r(c),a.d(c,{DashboardModule:()=>w});var d=a(177),r=a(2791),h=a(5964),p=a(1413),n=a(7705),g=a(5075),b=a(4956),v=a(499);function f(t,o){1&t&&(n.j41(0,"p",16),n.EFF(1," Plataforma de anuncios clasificados "),n.k0s())}function k(t,o){1&t&&(n.j41(0,"p",16),n.EFF(1," Panel de administraci\xf3n completo "),n.k0s())}function F(t,o){if(1&t&&(n.j41(0,"p",37),n.EFF(1),n.k0s()),2&t){const e=n.XpG(2);n.R7$(1),n.SpI(" Te quedan ",e.remainingAnnouncements," anuncios disponibles ")}}function A(t,o){1&t&&(n.j41(0,"p",38),n.EFF(1," Has alcanzado el l\xedmite de anuncios. Elimina alguno para crear uno nuevo. "),n.k0s())}function x(t,o){if(1&t&&(n.j41(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"div",5)(5,"div",21)(6,"h3",22),n.EFF(7,"Tus Anuncios"),n.k0s(),n.j41(8,"div",23)(9,"span",24),n.EFF(10),n.k0s(),n.j41(11,"span",25),n.EFF(12,"/"),n.k0s(),n.j41(13,"span",26),n.EFF(14),n.k0s()(),n.DNE(15,F,2,1,"p",27),n.DNE(16,A,2,0,"p",28),n.k0s(),n.j41(17,"div",29)(18,"div",30)(19,"div",31)(20,"i",32),n.nrm(21,"span",12)(22,"span",13)(23,"span",33)(24,"span",34)(25,"span",35)(26,"span",36),n.k0s()()()()()()()()()),2&t){const e=n.XpG();n.R7$(10),n.JRh(e.userAnnouncementsCount),n.R7$(4),n.JRh(e.maxAnnouncements),n.R7$(1),n.Y8G("ngIf",e.remainingAnnouncements>0),n.R7$(1),n.Y8G("ngIf",0===e.remainingAnnouncements)}}function j(t,o){if(1&t){const e=n.RV6();n.j41(0,"div",17)(1,"div",6)(2,"div",39)(3,"div",40)(4,"i",41),n.nrm(5,"span",12)(6,"span",13),n.k0s(),n.j41(7,"h3",42),n.EFF(8,"Crear Anuncio"),n.k0s(),n.j41(9,"p",43),n.EFF(10,"Publica un nuevo clasificado"),n.k0s(),n.j41(11,"button",44),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.createAnnouncement())}),n.EFF(12," Crear Nuevo "),n.k0s()()()(),n.j41(13,"div",6)(14,"div",45)(15,"div",40)(16,"i",46),n.nrm(17,"span",12)(18,"span",13),n.k0s(),n.j41(19,"h3",42),n.EFF(20,"Mis Anuncios"),n.k0s(),n.j41(21,"p",43),n.EFF(22,"Gestionar anuncios existentes"),n.k0s(),n.j41(23,"button",47),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.listMyAnnouncements())}),n.EFF(24," Ver Lista "),n.k0s()()()()()}if(2&t){const e=n.XpG();n.R7$(11),n.Y8G("disabled",e.userAnnouncementsCount>=e.maxAnnouncements)}}function E(t,o){if(1&t){const e=n.RV6();n.j41(0,"div",48)(1,"div",49)(2,"h2",50),n.EFF(3,"Panel de Administraci\xf3n"),n.k0s(),n.j41(4,"p",43),n.EFF(5,"Gestiona todos los aspectos de la plataforma AvisOnline"),n.k0s()(),n.j41(6,"div",51)(7,"div",52)(8,"div",40)(9,"i",53),n.nrm(10,"span",12)(11,"span",13)(12,"span",33)(13,"span",34),n.k0s(),n.j41(14,"h3",42),n.EFF(15,"Categor\xedas"),n.k0s(),n.j41(16,"p",43),n.EFF(17,"Gestionar categor\xedas de anuncios"),n.k0s(),n.j41(18,"button",54),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.manageCategories())}),n.EFF(19," Gestionar "),n.k0s()()()(),n.j41(20,"div",51)(21,"div",55)(22,"div",40)(23,"i",56),n.nrm(24,"span",12)(25,"span",13),n.k0s(),n.j41(26,"h3",42),n.EFF(27,"Sliders"),n.k0s(),n.j41(28,"p",43),n.EFF(29,"Configurar banner principal"),n.k0s(),n.j41(30,"button",57),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.manageSliders())}),n.EFF(31," Gestionar "),n.k0s()()()(),n.j41(32,"div",51)(33,"div",45)(34,"div",40)(35,"i",58),n.nrm(36,"span",12)(37,"span",13)(38,"span",33)(39,"span",34)(40,"span",35)(41,"span",36),n.k0s(),n.j41(42,"h3",42),n.EFF(43,"Anuncios"),n.k0s(),n.j41(44,"p",43),n.EFF(45,"Ver todos los anuncios"),n.k0s(),n.j41(46,"button",47),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.listMyAnnouncements())}),n.EFF(47," Ver Todos "),n.k0s()()()(),n.j41(48,"div",51)(49,"div",39)(50,"div",40)(51,"i",59),n.nrm(52,"span",12)(53,"span",13)(54,"span",33)(55,"span",34)(56,"span",35),n.k0s(),n.j41(57,"h3",42),n.EFF(58,"Usuarios"),n.k0s(),n.j41(59,"p",43),n.EFF(60,"Gestionar usuarios del sistema"),n.k0s(),n.j41(61,"button",60),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.manageUsers())}),n.EFF(62," Gestionar "),n.k0s()()()(),n.j41(63,"div",51)(64,"div",61)(65,"div",40)(66,"i",62),n.nrm(67,"span",12)(68,"span",13),n.k0s(),n.j41(69,"h3",42),n.EFF(70,"Roles"),n.k0s(),n.j41(71,"p",43),n.EFF(72,"Configurar roles de usuario"),n.k0s(),n.j41(73,"button",63),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.manageRoles())}),n.EFF(74," Gestionar "),n.k0s()()()(),n.j41(75,"div",51)(76,"div",64)(77,"div",40)(78,"i",65),n.nrm(79,"span",12)(80,"span",13),n.k0s(),n.j41(81,"h3",42),n.EFF(82,"Permisos"),n.k0s(),n.j41(83,"p",43),n.EFF(84,"Configurar permisos del sistema"),n.k0s(),n.j41(85,"button",66),n.bIt("click",function(){n.eBV(e);const s=n.XpG();return n.Njj(s.managePermissions())}),n.EFF(86," Gestionar "),n.k0s()()()()()}}let C=(()=>{class t{router;authService;permissionService;productService;cdr;destroy$=new p.B;userName="";isAdmin=!1;hasManageOwnProducts=!1;userAnnouncementsCount=0;maxAnnouncements=5;remainingAnnouncements=5;totalUsers=0;totalProducts=0;totalSales=0;totalRevenue=0;isLoading=!1;routerSubscription;constructor(e,i,s,_,G){this.router=e,this.authService=i,this.permissionService=s,this.productService=_,this.cdr=G}ngOnInit(){console.log("\u{1f680} Dashboard inicializado"),this.isLoading=!0,this.initializeUserData(),this.loadDashboardData(),this.routerSubscription=this.router.events.pipe((0,h.p)(e=>e instanceof r.wF)).subscribe(e=>{("/"===e.url||e.url.includes("/dashboard"))&&(console.log("\u{1f504} Navegaci\xf3n detectada, recargando dashboard...",e.url),setTimeout(()=>{this.reloadDashboard()},100))}),window.addEventListener("announcementUpdated",()=>{console.log("\u{1f4e1} Evento de actualizaci\xf3n de anuncio recibido"),setTimeout(()=>this.loadUserAnnouncementsCount(),500)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),window.removeEventListener("anuncio-created",this.handleAnuncioUpdate.bind(this)),window.removeEventListener("anuncio-deleted",this.handleAnuncioUpdate.bind(this)),this.routerSubscription&&this.routerSubscription.unsubscribe()}initializeUserData(){const e=this.authService.currentUserValue;e?(this.userName=e.name||"Usuario",this.isAdmin=this.permissionService.hasRole("Admin"),this.hasManageOwnProducts=this.permissionService.hasPermission("manage-own-announcements"),console.log("Usuario inicializado:",{name:this.userName,isAdmin:this.isAdmin,hasManageOwnProducts:this.hasManageOwnProducts})):console.warn("No hay usuario autenticado")}loadDashboardData(){this.isLoading=!0,setTimeout(()=>{this.isAdmin?this.loadAdminDashboard():this.hasManageOwnProducts?this.loadUserDashboard():(console.warn("Usuario sin permisos para ver anuncios"),this.isLoading=!1)},100)}loadAdminDashboard(){setTimeout(()=>{this.totalUsers=150,this.totalProducts=450,this.totalSales=120,this.totalRevenue=25e3,this.isLoading=!1},1e3)}loadUserDashboard(){this.loadUserAnnouncementsCount()}loadUserAnnouncementsCount(){console.log("\u{1f504} Cargando estad\xedsticas del usuario..."),this.productService.getUserStats().subscribe({next:e=>{console.log("\u2705 Estad\xedsticas del usuario obtenidas:",e),e.stats?(this.userAnnouncementsCount=Number(e.stats.total_announcements)||0,this.maxAnnouncements=Number(e.stats.max_allowed)||5,this.remainingAnnouncements=Number(e.stats.remaining_slots)||0,console.log("\u{1f4ca} Estad\xedsticas aplicadas:",{current:this.userAnnouncementsCount,max:this.maxAnnouncements,remaining:this.remainingAnnouncements}),this.cdr.detectChanges()):(console.warn("\u26a0\ufe0f Respuesta sin datos de estad\xedsticas"),this.setDefaultValues()),this.isLoading=!1},error:e=>{console.error("\u274c Error al cargar estad\xedsticas del usuario:",e),401===e.status?(console.warn("Usuario no autenticado, redirigiendo al login..."),this.setDefaultValues(),this.isLoading=!1):(console.log("\u{1f504} Intentando m\xe9todo fallback..."),this.loadUserAnnouncementsCountFallback())}})}setDefaultValues(){this.userAnnouncementsCount=0,this.maxAnnouncements=5,this.remainingAnnouncements=5,this.isLoading=!1,this.cdr.detectChanges()}loadUserAnnouncementsCountFallback(){this.productService.listProducts(1,{}).subscribe({next:e=>{console.log("Usando m\xe9todo fallback para obtener anuncios del usuario:",e),this.userAnnouncementsCount=e.products&&e.products.data?e.products.data.length:e.products?e.products.length:0,this.remainingAnnouncements=this.maxAnnouncements-this.userAnnouncementsCount,this.isLoading=!1,console.log("Conteo actualizado (fallback):",{current:this.userAnnouncementsCount,max:this.maxAnnouncements,remaining:this.remainingAnnouncements})},error:e=>{console.error("Error al cargar anuncios del usuario (fallback):",e),this.userAnnouncementsCount=0,this.remainingAnnouncements=this.maxAnnouncements,this.isLoading=!1}})}createAnnouncement(){this.userAnnouncementsCount>=this.maxAnnouncements?alert("Has alcanzado el l\xedmite m\xe1ximo de anuncios"):this.router.navigate(["/products/register"])}listMyAnnouncements(){this.router.navigate(["/products/list"])}manageCategories(){this.router.navigate(["/categories"])}manageSliders(){this.router.navigate(["/sliders/list"])}manageUsers(){this.router.navigate(["/apps/users"])}manageRoles(){this.router.navigate(["/apps/roles"])}managePermissions(){this.router.navigate(["/apps/permissions"])}manageCoupons(){this.router.navigate(["/cupones/list"])}manageDiscounts(){this.router.navigate(["/discount/list"])}viewSales(){this.router.navigate(["/sales/list"])}viewReports(){this.router.navigate(["/reports"])}refreshDashboard(){this.loadDashboardData()}getGreeting(){const e=(new Date).getHours();return e<12?"Buenos d\xedas":e<18?"Buenas tardes":"Buenas noches"}getAnnouncementUsagePercentage(){return 0===this.maxAnnouncements?0:Math.round(this.userAnnouncementsCount/this.maxAnnouncements*100)}getUsageProgressClass(){const e=this.getAnnouncementUsagePercentage();return e>=90?"bg-danger":e>=70?"bg-warning":"bg-success"}reloadDashboard(){this.isAdmin||this.loadUserAnnouncementsCount()}setupAnuncioEventListeners(){window.addEventListener("anuncio-created",this.handleAnuncioUpdate.bind(this)),window.addEventListener("anuncio-deleted",this.handleAnuncioUpdate.bind(this))}handleAnuncioUpdate(){console.log("Evento de anuncio detectado, actualizando dashboard..."),this.reloadDashboard()}checkForUpdates(){"true"===localStorage.getItem("dashboard_needs_update")&&(localStorage.removeItem("dashboard_needs_update"),setTimeout(()=>{this.reloadDashboard()},500))}static \u0275fac=function(i){return new(i||t)(n.rXU(r.Ix),n.rXU(g.u),n.rXU(b.n),n.rXU(v.b),n.rXU(n.gRc))};static \u0275cmp=n.VBU({type:t,selectors:[["app-dashboard"]],decls:20,vars:6,consts:[[1,"container-fluid"],[1,"row","mb-5"],[1,"col-12"],[1,"card","bg-primary","bg-gradient"],[1,"card-body","p-9"],[1,"row","align-items-center"],[1,"col-lg-6"],[1,"text-white","mb-3"],[1,"text-white-75","mb-0"],["class","text-white-50 mt-2",4,"ngIf"],[1,"col-lg-6","text-end"],[1,"ki-duotone","ki-home","fs-4x","text-white-50"],[1,"path1"],[1,"path2"],["class","row mb-8",4,"ngIf"],["class","row",4,"ngIf"],[1,"text-white-50","mt-2"],[1,"row","mb-8"],[1,"col-lg-12"],[1,"card"],[1,"card-body","p-8"],[1,"col-lg-8"],[1,"card-title","mb-3"],[1,"d-flex","align-items-center"],[1,"fs-2hx","fw-bold","text-gray-800","me-2"],[1,"fs-4","text-muted"],[1,"fs-1","fw-semibold","text-muted","ms-2"],["class","text-muted mt-2",4,"ngIf"],["class","text-warning mt-2",4,"ngIf"],[1,"col-lg-4","text-end"],[1,"symbol","symbol-100px"],[1,"symbol-label","bg-light-primary"],[1,"ki-duotone","ki-notepad-bookmark","fs-2x","text-primary"],[1,"path3"],[1,"path4"],[1,"path5"],[1,"path6"],[1,"text-muted","mt-2"],[1,"text-warning","mt-2"],[1,"card","bg-light-success","hover-elevate-up"],[1,"card-body","p-8","text-center"],[1,"ki-duotone","ki-plus","fs-3x","text-success","mb-5"],[1,"card-title"],[1,"text-muted"],[1,"btn","btn-success",3,"disabled","click"],[1,"card","bg-light-info","hover-elevate-up"],[1,"ki-duotone","ki-files","fs-3x","text-info","mb-5"],[1,"btn","btn-info",3,"click"],[1,"row"],[1,"col-12","mb-5"],[1,"text-gray-800"],[1,"col-lg-4","mb-8"],[1,"card","bg-light-primary","hover-elevate-up"],[1,"ki-duotone","ki-category","fs-3x","text-primary","mb-5"],[1,"btn","btn-primary",3,"click"],[1,"card","bg-light-warning","hover-elevate-up"],[1,"ki-duotone","ki-picture","fs-3x","text-warning","mb-5"],[1,"btn","btn-warning",3,"click"],[1,"ki-duotone","ki-notepad-bookmark","fs-3x","text-info","mb-5"],[1,"ki-duotone","ki-users","fs-3x","text-success","mb-5"],[1,"btn","btn-success",3,"click"],[1,"card","bg-light-danger","hover-elevate-up"],[1,"ki-duotone","ki-security-user","fs-3x","text-danger","mb-5"],[1,"btn","btn-danger",3,"click"],[1,"card","bg-light-dark","hover-elevate-up"],[1,"ki-duotone","ki-shield-check","fs-3x","text-dark","mb-5"],[1,"btn","btn-dark",3,"click"]],template:function(i,s){1&i&&(n.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h1",7),n.EFF(8,"\xa1Bienvenido a AvisOnline!"),n.k0s(),n.j41(9,"h3",8),n.EFF(10),n.k0s(),n.DNE(11,f,2,0,"p",9),n.DNE(12,k,2,0,"p",9),n.k0s(),n.j41(13,"div",10)(14,"i",11),n.nrm(15,"span",12)(16,"span",13),n.k0s()()()()()()(),n.DNE(17,x,27,4,"div",14),n.DNE(18,j,25,1,"div",14),n.DNE(19,E,87,0,"div",15),n.k0s()),2&i&&(n.R7$(10),n.JRh(s.userName),n.R7$(1),n.Y8G("ngIf",!s.isAdmin),n.R7$(1),n.Y8G("ngIf",s.isAdmin),n.R7$(5),n.Y8G("ngIf",!s.isAdmin&&s.hasManageOwnProducts),n.R7$(1),n.Y8G("ngIf",!s.isAdmin),n.R7$(1),n.Y8G("ngIf",s.isAdmin))},dependencies:[d.bT],styles:["[_nghost-%COMP%]{width:100%}.h-100[_ngcontent-%COMP%]{height:100%}"]})}return t})();var u=a(5236),D=a(1626),l=a(9417),m=a(928),U=a(4035);let w=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=n.$C({type:t});static \u0275inj=n.G2t({imports:[d.MD,r.iI.forChild([{path:"",component:C}]),u.ST,u.Dk,D.q1,l.YN,m.UN,l.X1,U.e1,m.XZ]})}return t})()}}]);