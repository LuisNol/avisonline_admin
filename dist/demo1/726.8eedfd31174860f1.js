"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[726],{8726:(se,v,a)=>{a.r(v),a.d(v,{RoleModule:()=>ne});var d=a(6814),e=a(5879),h=a(4468),m=a(7304),_=a(5722);const Z=["noticeSwal"];function y(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"div",22),e._UZ(2,"span",23),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.BQk()),2&n){const t=s.$implicit;e.xp6(3),e.hij("",e.lcZ(4,1,t.name)," ")}}const g=function(){return[]};function T(n,s){if(1&n&&(e.TgZ(0,"div",22),e._UZ(1,"span",23),e.TgZ(2,"em"),e._uU(3),e.qZA()()),2&n){const t=e.oxw().$implicit;e.xp6(3),e.hij(" ",0===(t.permissions||e.DdM(1,g)).length?"No permissions given...":"and "+((t.permissions||e.DdM(2,g)).length-5)+" more..."," ")}}const C=function(n){return["/apps/roles",n]},A=function(n){return["/apps/roles/edit",n]};function R(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14)(5,"h2"),e._uU(6),e.ALo(7,"titlecase"),e.qZA()()(),e.TgZ(8,"div",15)(9,"div",16),e._uU(10),e.qZA(),e.TgZ(11,"div",17),e.YNc(12,y,5,3,"ng-container",10),e.YNc(13,T,4,3,"div",18),e.qZA()(),e.TgZ(14,"div",19)(15,"a",20),e._uU(16,"View Role"),e.qZA(),e.TgZ(17,"a",21),e._uU(18,"Edit Role"),e.qZA()()()(),e.BQk()),2&n){const t=s.$implicit;e.xp6(6),e.Oqu(e.lcZ(7,6,t.name)),e.xp6(4),e.hij("Total users with this role: ",(t.users||e.DdM(8,g)).length,""),e.xp6(2),e.Q6J("ngForOf",(t.permissions||e.DdM(9,g)).slice(0,5)),e.xp6(1),e.Q6J("ngIf",(t.permissions||e.DdM(10,g)).length>5||0===(t.permissions||e.DdM(11,g)).length),e.xp6(2),e.Q6J("routerLink",e.VKq(12,C,t.id)),e.xp6(2),e.Q6J("routerLink",e.VKq(14,A,t.id))}}function w(n,s){if(1&n&&(e.ynx(0),e.YNc(1,R,19,16,"ng-container",10),e.BQk()),2&n){const t=s.ngIf;e.xp6(1),e.Q6J("ngForOf",t.data)}}let I=(()=>{class n{apiService;cdr;roles$;noticeSwal;swalOptions={};constructor(t,o){this.apiService=t,this.cdr=o}ngOnInit(){this.roles$=this.apiService.getRoles()}ngOnDestroy(){}static \u0275fac=function(o){return new(o||n)(e.Y36(h.N),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-role-listing"]],viewQuery:function(o,i){if(1&o&&e.Gf(Z,5),2&o){let r;e.iGM(r=e.CRH())&&(i.noticeSwal=r.first)}},decls:12,vars:4,consts:[[1,"row","row-cols-1","row-cols-md-2","row-cols-xl-3","g-5","g-xl-9"],[4,"ngIf"],[1,"ol-md-4"],[1,"card","h-md-100"],[1,"card-body","d-flex","flex-center"],["routerLink","/apps/roles/create",1,"btn","btn-clear","d-flex","flex-column","flex-center"],["src","assets/media/illustrations/sketchy-1/4.png","alt","",1,"mw-100","mh-150px","mb-7"],[1,"fw-bold","fs-3","text-gray-600","text-hover-primary"],[3,"swalOptions"],["noticeSwal",""],[4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","card-flush","h-md-100"],[1,"card-header"],[1,"card-title"],[1,"card-body","pt-1"],[1,"fw-bold","text-gray-600","mb-5"],[1,"d-flex","flex-column","text-gray-600"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"card-footer","flex-wrap","pt-0"],[1,"btn","btn-light","btn-active-primary","my-1","me-2",3,"routerLink"],[1,"btn","btn-light","btn-active-light-primary","my-1",3,"routerLink"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0),e.YNc(1,w,2,1,"ng-container",1),e.ALo(2,"async"),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"a",5),e._UZ(7,"img",6),e.TgZ(8,"div",7),e._uU(9,"Add New Role"),e.qZA()()()()()(),e._UZ(10,"swal",8,9)),2&o&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,i.roles$)),e.xp6(9),e.Q6J("swalOptions",i.swalOptions))},dependencies:[d.sg,d.O5,m.rH,_.q1,d.Ov,d.rS]})}return n})();var U=a(6676),x=a.n(U),S=a(431);function E(n,s){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"span",19),e._uU(2),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.name," ")}}function Q(n,s){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"span",19),e.TgZ(2,"em"),e._uU(3),e.qZA()()),2&n){const t=e.oxw(2).ngIf;e.xp6(3),e.hij("and ",(t.permissions.length||0)-5," more...")}}function J(n,s){if(1&n&&(e.ynx(0),e.YNc(1,E,3,1,"div",17),e.YNc(2,Q,4,1,"div",17),e.BQk()),2&n){const t=s.index,o=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",t<5),e.xp6(1),e.Q6J("ngIf",5===t&&(o.permissions.length||0)>5)}}const L=function(){return[]};function N(n,s){if(1&n&&(e.ynx(0),e.YNc(1,J,3,2,"ng-container",16),e.BQk()),2&n){const t=s.ngIf;e.xp6(1),e.Q6J("ngForOf",t.permissions||e.DdM(1,L))}}const O=function(n){return["/apps/roles/edit",n]};function q(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"a",20),e._uU(2,"Editar Rol"),e.qZA(),e.BQk()),2&n){const t=s.ngIf;e.xp6(1),e.Q6J("routerLink",e.VKq(1,O,t.id))}}function F(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"span",21),e._uU(2),e.qZA(),e.BQk()),2&n){const t=s.ngIf;e.xp6(2),e.hij("(",t.users.length||0,")")}}let Y=(()=>{class n{route;apiService;role$;datatableConfig={};reloadEvent=new e.vpe;constructor(t,o){this.route=t,this.apiService=o}ngOnInit(){this.route.params.subscribe(t=>{const o=t.id;this.role$=this.apiService.getRole(o),this.datatableConfig={serverSide:!0,ajax:(i,r)=>{this.apiService.getUsers(o,i).subscribe(l=>{console.log(l),r(l)})},columns:[{title:"Name",data:"name",render:function(i,r,l){const p=["success","info","warning","danger"],f=p[Math.floor(Math.random()*p.length)],ie=i[0].toUpperCase();return`\n              <div class="symbol symbol-circle symbol-50px overflow-hidden me-3" data-action="view" data-id="${l.id}">\n                <a href="javascript:;">\n                  \n              <div class="symbol-label fs-3 bg-light-${f} text-${f}">\n                ${ie}\n              </div>\n            \n                </a>\n              </div>\n              \n              <div class="d-flex flex-column" data-action="view" data-id="${l.id}">\n                <a href="javascript:;" class="text-gray-800 text-hover-primary mb-1">${i}</a>\n                <span>${l.email}</span>\n              </div>\n            \n            `}},{title:"Role",data:"role",render:function(i,r,l){const p=l.roles||[];return(p.length>0?p[0]?.name:"")||""},orderData:[1],orderSequence:["asc","desc"],type:"string"},{title:"Last Login",data:"last_login_at",render:(i,r,l)=>{const p=i||l.created_at;return`<div class="badge badge-light fw-bold">${x()(p).fromNow()}</div>`}},{title:"Joined Date",data:"created_at",render:function(i){return x()(i).format("DD MMM YYYY, hh:mm a")}}],createdRow:function(i,r,l){$("td:eq(0)",i).addClass("d-flex align-items-center")}}})}deleteUser(t){this.route.params.subscribe(o=>{this.apiService.deleteUser(o.id,t).subscribe(()=>{this.reloadEvent.emit(!0)})})}static \u0275fac=function(o){return new(o||n)(e.Y36(m.gz),e.Y36(h.N))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-role-details"]],decls:26,vars:14,consts:[[1,"d-flex","flex-column","flex-lg-row"],[1,"flex-column","flex-lg-row-auto","w-100","w-lg-200px","w-xl-300px","mb-10"],[1,"card","card-flush"],[1,"card-header"],[1,"card-title"],[1,"mb-0"],[1,"card-body","pt-0"],[1,"d-flex","flex-column","text-gray-600"],[4,"ngIf"],[1,"card-footer","pt-0"],[1,"flex-lg-row-fluid","ms-lg-10"],[1,"card","card-flush","mb-6","mb-xl-9"],[1,"card-header","pt-5"],[1,"d-flex","align-items-center"],[1,"card-toolbar"],[3,"datatableConfig","reload","deleteEvent"],[4,"ngFor","ngForOf"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[1,"btn","btn-light","btn-active-primary",3,"routerLink"],[1,"text-gray-600","fs-6","ms-1"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e._uU(6),e.ALo(7,"async"),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7),e.YNc(10,N,2,2,"ng-container",8),e.ALo(11,"async"),e.qZA()(),e.TgZ(12,"div",9),e.YNc(13,q,3,3,"ng-container",8),e.ALo(14,"async"),e.qZA()()(),e.TgZ(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",4)(19,"h2",13),e._uU(20,"Users Assigned "),e.YNc(21,F,3,1,"ng-container",8),e.ALo(22,"async"),e.qZA()(),e._UZ(23,"div",14),e.qZA(),e.TgZ(24,"div",6)(25,"app-crud",15),e.NdJ("deleteEvent",function(l){return i.deleteUser(l)}),e.qZA()()()()()),2&o){let r;e.xp6(6),e.hij(" ",null==(r=e.lcZ(7,6,i.role$))?null:r.name," "),e.xp6(4),e.Q6J("ngIf",e.lcZ(11,8,i.role$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(14,10,i.role$)),e.xp6(8),e.Q6J("ngIf",e.lcZ(22,12,i.role$)),e.xp6(4),e.Q6J("datatableConfig",i.datatableConfig)("reload",i.reloadEvent)}},dependencies:[d.sg,d.O5,m.rH,S.D,d.Ov]})}return n})();var c=a(6223),u=a(1274),D=a(4955),M=a(9155),j=a(7398),k=a(9315),B=a(6910);function P(n,s){1&n&&(e.TgZ(0,"small"),e._uU(1,"El nombre del rol es obligatorio"),e.qZA())}function G(n,s){1&n&&(e.TgZ(0,"small"),e._uU(1,"El nombre debe tener al menos 3 caracteres"),e.qZA())}function H(n,s){if(1&n&&(e.TgZ(0,"div",19),e.YNc(1,P,2,0,"small",17),e.YNc(2,G,2,0,"small",17),e.qZA()),2&n){const t=e.oxw();let o,i;e.xp6(1),e.Q6J("ngIf",null==(o=t.roleForm.get("name"))?null:o.hasError("required")),e.xp6(1),e.Q6J("ngIf",null==(i=t.roleForm.get("name"))?null:i.hasError("minlength"))}}function V(n,s){1&n&&(e.TgZ(0,"div",20)(1,"div",21)(2,"span",22),e._uU(3,"Cargando..."),e.qZA()()())}function z(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",26)(2,"input",27),e.NdJ("change",function(){const r=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.togglePermission(r.id))}),e.qZA(),e.TgZ(3,"label",28),e._uU(4),e.qZA()()()}if(2&n){const t=s.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("id","permission_"+t.id)("checked",o.isPermissionSelected(t.id)),e.xp6(1),e.Q6J("for","permission_"+t.id),e.xp6(1),e.hij(" ",t.name," ")}}function K(n,s){if(1&n&&(e.TgZ(0,"div",23),e.YNc(1,z,5,4,"div",24),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.permissions)}}function X(n,s){1&n&&(e.TgZ(0,"div",29),e._uU(1," No hay permisos disponibles en el sistema. "),e.qZA())}function W(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"Guardar"),e.qZA())}function ee(n,s){1&n&&(e.TgZ(0,"span",30),e._uU(1," Guardando... "),e._UZ(2,"span",31),e.qZA())}const te=function(){return["/apps/roles"]};let b=(()=>{class n{fb;roleService;permissionService;route;router;roleForm;role;roleId;permissions=[];isLoading=!1;isSubmitting=!1;constructor(t,o,i,r,l){this.fb=t,this.roleService=o,this.permissionService=i,this.route=r,this.router=l,this.roleForm=this.fb.group({name:["",[c.kI.required,c.kI.minLength(3)]],description:[""],permissions:[[]]})}ngOnInit(){this.route.params.subscribe(t=>{this.roleId=+t.id,this.loadData()})}loadData(){this.isLoading=!0;const t=this.permissionService.getPermissions({}).pipe((0,j.U)(i=>i.data)),o=this.roleId?this.roleService.getRole(this.roleId):null;o?(0,k.D)([t,o]).subscribe({next:([i,r])=>{this.permissions=i,this.role=r,this.roleForm.patchValue({name:r.name,description:r.description||"",permissions:r.permissions.map(l=>l.id)}),this.isLoading=!1},error:i=>{console.error("Error loading data",i),this.isLoading=!1}}):t.subscribe({next:i=>{this.permissions=i,this.isLoading=!1},error:i=>{console.error("Error loading permissions",i),this.isLoading=!1}})}onSubmit(){if(this.roleForm.invalid)return;this.isSubmitting=!0;const t=this.roleForm.value;(this.roleId?this.roleService.updateRole(this.roleId,t):this.roleService.createRole(t)).subscribe({next:()=>{this.showSuccessAlert(),this.router.navigate(["/apps/roles"])},error:i=>{console.error("Error saving role",i),this.showErrorAlert(i),this.isSubmitting=!1},complete:()=>{this.isSubmitting=!1}})}isPermissionSelected(t){const o=this.roleForm.get("permissions")?.value;return!!o&&o.includes(t)}togglePermission(t){const o=this.roleForm.get("permissions")?.value||[],i=o.indexOf(t);i>-1?o.splice(i,1):o.push(t),this.roleForm.patchValue({permissions:o})}showSuccessAlert(){alert(this.roleId?"Rol actualizado correctamente":"Rol creado correctamente")}showErrorAlert(t){const o={icon:"error",title:"Error",text:this.extractErrorMessage(t)||"Ha ocurrido un error al guardar el rol",confirmButtonText:"Aceptar"};alert(o.text)}extractErrorMessage(t){if(t.error&&"object"==typeof t.error){const o=[];for(const i in t.error)Array.isArray(t.error[i])&&o.push(...t.error[i]);return o.join("\n")}return t.message||t.statusText||"Error desconocido"}static \u0275fac=function(o){return new(o||n)(e.Y36(c.qu),e.Y36(h.N),e.Y36(B.$),e.Y36(m.gz),e.Y36(m.F0))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-role-edit"]],decls:27,vars:11,consts:[[1,"card"],[1,"card-header"],[1,"card-title"],[3,"formGroup","ngSubmit"],[1,"card-body"],[1,"mb-5"],[1,"form-label","required"],["type","text","formControlName","name","placeholder","Ej: Admin, Editor, Vendedor, etc.",1,"form-control"],["class","text-danger mt-2",4,"ngIf"],[1,"form-label"],["formControlName","description","rows","3","placeholder","Describe las responsabilidades de este rol...",1,"form-control"],["class","d-flex justify-content-center my-5",4,"ngIf"],["class","permission-list",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"card-footer"],["type","button",1,"btn","btn-light","me-3",3,"routerLink"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["class","indicator-progress",4,"ngIf"],[1,"text-danger","mt-2"],[1,"d-flex","justify-content-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"permission-list"],["class","permission-item",4,"ngFor","ngForOf"],[1,"permission-item"],[1,"form-check","form-check-custom","form-check-solid"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],[1,"alert","alert-warning"],[1,"indicator-progress"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,i){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA()(),e.TgZ(4,"form",3),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Nombre del Rol"),e.qZA(),e._UZ(9,"input",7),e.YNc(10,H,3,2,"div",8),e.qZA(),e.TgZ(11,"div",5)(12,"label",9),e._uU(13,"Descripci\xf3n"),e.qZA(),e._UZ(14,"textarea",10),e.qZA(),e.TgZ(15,"div",5)(16,"label",9),e._uU(17,"Permisos"),e.qZA(),e.YNc(18,V,4,0,"div",11),e.YNc(19,K,2,1,"div",12),e.YNc(20,X,2,0,"div",13),e.qZA()(),e.TgZ(21,"div",14)(22,"button",15),e._uU(23," Cancelar "),e.qZA(),e.TgZ(24,"button",16),e.YNc(25,W,2,0,"span",17),e.YNc(26,ee,3,0,"span",18),e.qZA()()()()),2&o){let r;e.xp6(3),e.Oqu(i.roleId?"Editar Rol":"Crear Nuevo Rol"),e.xp6(1),e.Q6J("formGroup",i.roleForm),e.xp6(6),e.Q6J("ngIf",(null==(r=i.roleForm.get("name"))?null:r.invalid)&&((null==(r=i.roleForm.get("name"))?null:r.dirty)||(null==(r=i.roleForm.get("name"))?null:r.touched))),e.xp6(8),e.Q6J("ngIf",i.isLoading),e.xp6(1),e.Q6J("ngIf",!i.isLoading),e.xp6(1),e.Q6J("ngIf",!i.isLoading&&0===i.permissions.length),e.xp6(2),e.Q6J("routerLink",e.DdM(10,te)),e.xp6(2),e.Q6J("disabled",i.roleForm.invalid||i.isSubmitting),e.xp6(1),e.Q6J("ngIf",!i.isSubmitting),e.xp6(1),e.Q6J("ngIf",i.isSubmitting)}},dependencies:[d.sg,d.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,m.rH],styles:['.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.required[_ngcontent-%COMP%]:after{content:" *";color:red}.permission-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.permission-item[_ngcontent-%COMP%]{padding:.5rem;border-bottom:1px solid #eee}.permission-item[_ngcontent-%COMP%]:last-child{border-bottom:none}']})}return n})(),ne=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[d.ez,c.u5,c.UX,m.Bz.forChild([{path:"",component:I},{path:"create",component:b},{path:"edit/:id",component:b},{path:":id",component:Y}]),M.Z,D.m,u.Oz,u.XC,u.lQ,u.HK,_.ii.forChild()]})}return n})()}}]);